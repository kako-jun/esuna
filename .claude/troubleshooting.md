# Esuna トラブルシューティング

よくある問題と解決方法をまとめたガイドです。

---

## 🔊 音声関連の問題

### 音声が出ない

#### 症状
- ボタンを押しても何も読み上げられない
- 音声ガイダンスが聞こえない

#### 原因と対処法

**1. ブラウザが音声合成に対応していない**
- **確認方法**: 開発者ツールのコンソールで `window.speechSynthesis` を確認
- **対処法**: Chrome、Edge、Safari等のモダンブラウザを使用

**2. 音量がミュートになっている**
- **確認方法**: システムの音量設定を確認
- **対処法**: 音量を上げる、ミュート解除

**3. SpeechManagerが初期化されていない**
- **確認方法**: コンソールで `speechManager is null` エラー
- **対処法**: ページをリロードして再初期化

**4. 音声の読み込みに時間がかかっている**
- **確認方法**: 初回起動時に遅延
- **対処法**: 数秒待つ（音声エンジンの読み込み時間）

---

### 音声が途切れる・止まらない

#### 症状
- 読み上げ中に音声が途切れる
- Escapeキーを押しても止まらない

#### 原因と対処法

**1. 複数の音声が同時に再生されている**
- **確認方法**: 音声が重なって聞こえる
- **対処法**:
  ```typescript
  speech.speak(text, { interrupt: true })
  ```
  `interrupt: true` を指定して前の音声を中断

**2. 長文の読み上げ中**
- **確認方法**: 小説等の長文を読み上げ中
- **対処法**: `speech.stop()` を明示的に呼ぶ

**3. ブラウザのバグ**
- **確認方法**: 特定のブラウザでのみ発生
- **対処法**: ページをリロード、別のブラウザを試す

---

### 音声が速すぎる・遅すぎる

#### 症状
- 読み上げ速度が不適切

#### 対処法
1. 設定ページを開く
2. 速度調整ボタンで変更
3. 好みの速度を保存

設定値:
- 遅: 0.7倍
- 標準: 1.0倍
- 速: 1.5倍

---

## 💾 ストレージ関連の問題

### LocalStorageがいっぱいになった

#### 症状
- 「容量がいっぱいです」エラー
- 音声メモが保存できない
- お気に入りが追加できない

#### 対処法

**1. 不要な音声メモを削除**
```
メニュー → ツール → メモ → 古いメモを削除
```

**2. ブラウザのキャッシュをクリア**
- Chrome: 設定 → プライバシーとセキュリティ → 閲覧履歴データの削除
- ただし、Esunaの設定も消えるので注意

**3. IndexedDB移行（将来対応予定）**
- 現在は未対応
- v0.8.0で対応予定

---

### 設定が保存されない

#### 症状
- 設定を変更してもリロードすると元に戻る
- お気に入りが消える

#### 原因と対処法

**1. プライベートブラウジングモード**
- **確認方法**: シークレットモード、プライベートウィンドウを使用
- **対処法**: 通常モードで使用

**2. LocalStorageが無効**
- **確認方法**: ブラウザ設定でCookieやストレージが無効
- **対処法**: LocalStorageを有効化

**3. ブラウザの拡張機能の干渉**
- **確認方法**: 特定の拡張機能を無効にすると直る
- **対処法**: 干渉する拡張機能を無効化

---

## 🎮 操作関連の問題

### キーボードが反応しない

#### 症状
- 1-9キーを押してもボタンが押されない
- 矢印キーが効かない

#### 原因と対処法

**1. フォーカスが外れている**
- **対処法**: 画面を一度クリックしてフォーカスを戻す

**2. 他のアプリがキーを奪っている**
- **確認方法**: スクリーンリーダー等が有効
- **対処法**: スクリーンリーダーを一時停止

**3. 入力フィールドにフォーカスがある**
- **確認方法**: テキスト入力欄が選択されている
- **対処法**: Tabキーでフォーカスを移動

---

### ボタンを押しても反応しない

#### 症状
- クリックしても何も起こらない
- グリッドが表示されない

#### 原因と対処法

**1. JavaScriptエラー**
- **確認方法**: 開発者ツールのコンソールにエラー
- **対処法**: ページをリロード

**2. ネットワークエラー**
- **確認方法**: オフライン状態
- **対処法**: ネットワーク接続を確認

**3. ブラウザの互換性問題**
- **確認方法**: 古いブラウザを使用
- **対処法**: ブラウザを最新版にアップデート

---

## 📡 ネットワーク関連の問題

### コンテンツが読み込めない

#### 症状
- 「データの取得に失敗しました」エラー
- ニュース、5ch等が表示されない

#### 原因と対処法

**1. バックエンドが起動していない**
- **確認方法**: `http://localhost:8000/docs` にアクセスできない
- **対処法**: バックエンドを起動
  ```bash
  cd backend
  python -m app.main
  ```

**2. CORS エラー**
- **確認方法**: コンソールに "CORS policy" エラー
- **対処法**: バックエンドのCORS設定を確認

**3. 外部サイトがダウンしている**
- **確認方法**: 特定のコンテンツのみ読み込めない
- **対処法**: 時間をおいて再試行

**4. レート制限**
- **確認方法**: 繰り返しアクセスした後にエラー
- **対処法**: しばらく待ってから再試行

---

### ラジオが再生されない

#### 症状
- ラジオ局を選択しても音が出ない
- 「再生に失敗しました」エラー

#### 原因と対処法

**1. NHKのストリーミングURLが変更された**
- **確認方法**: NHKらじるらじるのみエラー
- **対処法**: `frontend/src/lib/radio.ts` のURLを更新

**2. radikoは未対応**
- **確認方法**: radiko局を選択
- **対処法**: 現在radiko未対応、NHK局を使用

**3. ブラウザがHLS再生に対応していない**
- **確認方法**: Safariでは再生できるがChromeでできない
- **対処法**: hls.jsライブラリの導入（今後対応）

---

## 🎵 音声メモ関連の問題

### 録音できない

#### 症状
- 録音ボタンを押してもマイクが起動しない
- 「録音に失敗しました」エラー

#### 原因と対処法

**1. マイクの許可がない**
- **確認方法**: ブラウザに「マイクへのアクセスを許可」が表示
- **対処法**: 許可する

**2. マイクが接続されていない**
- **確認方法**: システム設定でマイクが検出されない
- **対処法**: マイクを接続、デバイスを再起動

**3. 他のアプリがマイクを使用中**
- **確認方法**: Zoom、Skype等が起動中
- **対処法**: 他のアプリを終了

**4. ブラウザがMediaRecorderに対応していない**
- **確認方法**: 古いブラウザ
- **対処法**: Chrome、Edge等のモダンブラウザを使用

---

### 音声メモが再生できない

#### 症状
- 録音はできるが再生できない
- 雑音が入る

#### 原因と対処法

**1. 音声形式の問題**
- **確認方法**: ブラウザによって再生できたりできなかったり
- **対処法**: 同じブラウザで録音・再生する

**2. データが破損している**
- **確認方法**: 特定のメモのみ再生できない
- **対処法**: そのメモを削除して再録音

**3. LocalStorageのデータ制限**
- **確認方法**: 長時間の録音後にエラー
- **対処法**: 録音時間を短くする（1分以内推奨）

---

## ⏰ タイマー関連の問題

### タイマーが動かない

#### 症状
- タイマーを開始しても時間が減らない
- 完了しても通知が来ない

#### 原因と対処法

**1. ブラウザがバックグラウンド状態**
- **確認方法**: 別のタブに切り替えている
- **対処法**: Esunaのタブをアクティブに保つ

**2. JavaScriptのsetIntervalが停止**
- **確認方法**: コンソールにエラー
- **対処法**: ページをリロード

**3. システムがスリープ状態**
- **確認方法**: PCがスリープから復帰した後
- **対処法**: タイマーを再設定

---

## 🔄 おまかせモード関連の問題

### プレイリストが生成されない

#### 症状
- おまかせモードを開始してもコンテンツが流れない
- 「プレイリストが空です」エラー

#### 原因と対処法

**1. すべてのコンテンツタイプがOFF**
- **確認方法**: 設定画面ですべてOFF
- **対処法**: 最低1つのコンテンツタイプをONにする

**2. コンテンツデータが空**
- **確認方法**: 小説、Podcast等のリストが空
- **対処法**: データファイルを確認

---

### コンテンツが切り替わらない

#### 症状
- 時間が経過してもコンテンツが変わらない

#### 原因と対処法

**1. 一時停止中**
- **確認方法**: 一時停止ボタンを押した
- **対処法**: 再生ボタンを押す

**2. タイマーが停止**
- **確認方法**: 残り時間が更新されない
- **対処法**: おまかせモードを再起動

---

## 🌐 ブラウザ別の問題

### Chrome
- **音声が途切れることがある**: 別のタブを開きすぎるとメモリ不足
- **対処法**: 不要なタブを閉じる

### Safari
- **音声合成の音質が低い**: Safari固有の制限
- **対処法**: 特になし（仕様）

### Firefox
- **MediaRecorderのフォーマットが異なる**: WebM Opus形式
- **対処法**: 録音・再生を同じブラウザで行う

### Edge
- **おおむね問題なし**: Chromiumベースで安定

---

## 🔧 開発者向けデバッグ

### コンソールでよく出るエラー

#### `speechManager is null`
- **原因**: SpeechManagerの初期化前にアクセス
- **対処**: useEffect内で初期化を待つ

#### `QuotaExceededError`
- **原因**: LocalStorage容量オーバー
- **対処**: 古いデータを削除

#### `Failed to fetch`
- **原因**: バックエンドが起動していない、CORSエラー
- **対処**: バックエンド起動、CORS設定確認

#### `Cannot read property 'speak' of null`
- **原因**: speechManagerがnullのままメソッド呼び出し
- **対処**: null チェック追加
  ```typescript
  if (speechManager) {
    speechManager.speak(text)
  }
  ```

---

### ビルドエラー

#### `Module not found`
- **原因**: インポートパスが間違っている
- **対処**: パスを修正、`@/` はsrcディレクトリのエイリアス

#### `Type error`
- **原因**: TypeScriptの型エラー
- **対処**: 型定義を確認、必要に応じて修正

#### `Unexpected token`
- **原因**: 構文エラー
- **対処**: コードを見直し、ESLintを実行

---

## 📞 サポート

### 解決しない場合

1. **GitHub Issuesで報告**
   - 再現手順を詳しく記載
   - エラーメッセージをコピペ
   - 環境情報（OS、ブラウザ、バージョン）

2. **開発者ツールのコンソールを確認**
   - F12キーで開発者ツールを開く
   - Console タブを確認
   - エラーメッセージをコピー

3. **ブラウザのバージョンを確認**
   - 古いバージョンでは動作しない可能性

---

## 🔍 診断フローチャート

### 音声が出ない場合
```
音声が出ない
  ↓
他のサイトで音声合成は動く？
  Yes → Esunaの問題 → ページをリロード
  No  → ブラウザの問題 → 音量確認、ブラウザ変更
```

### コンテンツが表示されない場合
```
コンテンツが表示されない
  ↓
バックエンドは起動している？
  Yes → 外部サイトの問題 → 時間をおいて再試行
  No  → バックエンドを起動
```

### ボタンが押せない場合
```
ボタンが押せない
  ↓
画面をクリックしてみる
  ↓
それでも押せない？
  Yes → ページをリロード
  No  → 解決
```

---

## 📝 エラーメッセージ一覧

| エラーメッセージ | 原因 | 対処法 |
|------------------|------|--------|
| データの取得に失敗しました | API呼び出しエラー | バックエンド確認、再試行 |
| 音声メモの保存に失敗しました | LocalStorage容量不足 | 古いメモ削除 |
| 再生に失敗しました | 音声ファイル読み込みエラー | ネットワーク確認 |
| ストリーミングの読み込みに失敗しました | ラジオURLエラー | 時間をおいて再試行 |
| 録音に失敗しました | マイク許可がない | マイクを許可 |

---

## 💡 予防策

### 定期的なメンテナンス
1. **月に1回**: 不要な音声メモを削除
2. **週に1回**: ブラウザのキャッシュクリア
3. **必要に応じて**: バックエンドを再起動

### 推奨環境
- **ブラウザ**: Chrome 最新版、Edge 最新版
- **OS**: Windows 10以上、macOS 10.15以上
- **ネットワーク**: 安定したインターネット接続

---

**このガイドで解決しない問題は、GitHubでIssueを立ててください。**
